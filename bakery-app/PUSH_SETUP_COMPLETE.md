# ‚úÖ Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è —á–∞—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã!

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

### 1. ‚úÖ Background Message Handler
- –°–æ–∑–¥–∞–Ω `index.js` —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º —Ñ–æ–Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –¢–µ–ø–µ—Ä—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –¥–∞–∂–µ –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ

### 2. ‚úÖ AndroidManifest.xml
- –î–æ–±–∞–≤–ª–µ–Ω –∫–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `support_chat_channel`
- –ù–∞—Å—Ç—Ä–æ–µ–Ω —Ü–≤–µ—Ç –∏–∫–æ–Ω–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 3. ‚úÖ –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –≤ —á–∞—Ç–µ
- –ß–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ —Ç–µ–º—É —Å–∏—Å—Ç–µ–º—ã
- –ö—Ä–∞—Å–∏–≤—ã–µ –ø—É–∑—ã—Ä–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 4. ‚úÖ Foreground —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ö–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ (–Ω–æ –≤—ã –Ω–µ –≤ —á–∞—Ç–µ), –ø–æ—è–≤–ª—è–µ—Ç—Å—è Alert
- –ö–Ω–æ–ø–∫–∞ "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å" –≤–µ–¥–µ—Ç –ø—Ä—è–º–æ –≤ —á–∞—Ç

### 5. ‚úÖ –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üöÄ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å Server Key –∏–∑ Firebase

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Project Settings** (‚öôÔ∏è ‚Üí Project settings)
4. –í–∫–ª–∞–¥–∫–∞ **Cloud Messaging**
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **Server key**

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å Server Key –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å

–û—Ç–∫—Ä–æ–π—Ç–µ `admin-chat.html` –∏ –Ω–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É:

```javascript
'Authorization': 'key=YOUR_SERVER_KEY' // TODO: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à Server Key
```

–ó–∞–º–µ–Ω–∏—Ç–µ `YOUR_SERVER_KEY` –Ω–∞ –≤–∞—à –∫–ª—é—á –∏–∑ Firebase.

### –®–∞–≥ 3: –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
cd android
./gradlew clean
./gradlew assembleRelease
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Expo:
```bash
npx expo run:android --variant release
```

---

## üì± –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –ö–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –û–¢–ö–†–´–¢–û:
1. –ê–¥–º–∏–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
2. –ï—Å–ª–∏ –≤—ã –≤ —á–∞—Ç–µ ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
3. –ï—Å–ª–∏ –≤—ã –ù–ï –≤ —á–∞—Ç–µ ‚Üí –ø–æ—è–≤–ª—è–µ—Ç—Å—è Alert —Å –∫–Ω–æ–ø–∫–æ–π "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å"

### –ö–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –°–í–ï–†–ù–£–¢–û/–ó–ê–ö–†–´–¢–û:
1. –ê–¥–º–∏–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
2. Android –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
3. –ù–∞–∂–∞—Ç–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

### –¢–µ—Å—Ç 1: Foreground (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ)
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ª—é–±–æ–π —Ä–∞–∑–¥–µ–ª (–ù–ï –≤ —á–∞—Ç)
3. –û—Ç–∫—Ä–æ–π—Ç–µ `admin-chat.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
5. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ—è–≤–∏—Ç—Å—è Alert "–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"

### –¢–µ—Å—Ç 2: Background (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–≤–µ—Ä–Ω—É—Ç–æ)
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –°–≤–µ—Ä–Ω–∏—Ç–µ –µ–≥–æ (Home button)
3. –û—Ç–∫—Ä–æ–π—Ç–µ `admin-chat.html`
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
5. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ —à—Ç–æ—Ä–∫–µ

### –¢–µ—Å—Ç 3: Killed (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ)
1. –ó–∞–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é (—Å–≤–∞–π–ø –∏–∑ –Ω–µ–¥–∞–≤–Ω–∏—Ö)
2. –û—Ç–∫—Ä–æ–π—Ç–µ `admin-chat.html`
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
4. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

---

## üé® –¢–µ–º–Ω–∞—è —Ç–µ–º–∞

–ß–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–º—É —Å–∏—Å—Ç–µ–º—ã:

- **–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞:** –ë–µ–ª—ã–µ –ø—É–∑—ã—Ä–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞, –æ—Ä–∞–Ω–∂–µ–≤—ã–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–¢–µ–º–Ω–∞—è —Ç–µ–º–∞:** –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–µ –ø—É–∑—ã—Ä–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞, –æ—Ä–∞–Ω–∂–µ–≤—ã–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ß—Ç–æ–±—ã –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:
**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –≠–∫—Ä–∞–Ω ‚Üí –¢–µ–º–Ω–∞—è —Ç–µ–º–∞**

---

## üîß Troubleshooting

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —Ñ–æ–Ω–µ:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Server Key:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `admin-chat.html`
   - –ù–∞–π–¥–∏—Ç–µ `Authorization: 'key=...'`
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ FCM —Ç–æ–∫–µ–Ω:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ Supabase ‚Üí Table Editor ‚Üí `user_fcm_tokens`
   - –î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–∏—Å—å —Å –≤–∞—à–∏–º `user_id`

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:**
   - –í –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–µ `notification: { title, body }`
   - –ë–µ–∑ —ç—Ç–æ–≥–æ –ø–æ–ª—è Android –Ω–µ –ø–æ–∫–∞–∂–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ foreground:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ: `üí¨ –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (foreground)`
3. –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `app/_layout.tsx`

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

–í `admin-chat.html` –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:
- `title` - –∑–∞–≥–æ–ª–æ–≤–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `body` - —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `android_channel_id` - –∫–∞–Ω–∞–ª (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å AndroidManifest)
- `sound` - –∑–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `priority` - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (high/normal)

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∫–æ–Ω–∫–∏:

1. –°–æ–∑–¥–∞–π—Ç–µ –∏–∫–æ–Ω–∫—É 24x24px (–±–µ–ª–∞—è –Ω–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–º —Ñ–æ–Ω–µ)
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ `android/app/src/main/res/drawable/ic_notification.png`
3. –í AndroidManifest –¥–æ–±–∞–≤—å—Ç–µ:
```xml
<meta-data
  android:name="com.google.firebase.messaging.default_notification_icon"
  android:resource="@drawable/ic_notification" />
```

---

## ‚ú® –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏! üéâ

–ù–µ –∑–∞–±—É–¥—å—Ç–µ:
1. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å Server Key –≤ `admin-chat.html`
2. ‚úÖ –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ 3 —Å—Ü–µ–Ω–∞—Ä–∏—è

–£–¥–∞—á–∏! üöÄ
